<!doctype html>
<html class="no-js" lang="en" dir="ltr">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Bonding</title>
  <link rel="stylesheet" type="text/css" href="css/foundation.css">
  <link rel="stylesheet" type="text/css" href="css/app.css">
  <link rel="stylesheet" type="text/css" href="css/SBTShirts.css" />
  <!-- google adding -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- google finished -->
</head>
<body>
<!-- starting -->
<div class="grid-container">
  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
        <div class=pageTitle>
          Physical Distancing, and Social BONDING!
          <br>Buy a shirt! Spread the word!
          <!-- <div type=button onclick=fillUp();>Fill the page</div> -->
        </div>
    </div>
  </div>

  <div id="product-list" class="grid-x grid-padding-x product">
    <!--begin skel -->
    <div id="product-XX" class="large-12 cell">
     <div class="grid-x grid-padding-x">
       <div class="large-4 medium-4 cell">
         <!--
         <div class=priceBar>
           <div id=shirtName-00 class=shirtType>White Long Sleeves</div>
              <div id=count-00><select class=oneColumn id="select-00"><option value="0" selected>0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
           <div id=priceTag-00> </div> <div id=size-00> </div> <div id=color-00> </div>
         </div>
        </div>
      -->
      </div>

      <div class="grid-x grid-padding-x">
        <div class="large-8 medium-8 cell">
          <div id=titleBar-00>
            <!--
            <div class=sideBy></div>
              <div id=XS-00 class=sizeButton onclick=scoreButton('XS-00'); prodID="#5e9ca2eb6aa6f5">XS </div>
              <div id=S-00 class=sizeButton onclick=scoreButton('S-00'); prodID="#5e9ca2eb6aa796">S </div>
              <div id=M-00 class=sizeButton onclick=scoreButton('M-00'); prodID="#5e9ca2eb6aa826"> M </div>
              <div id=L-00 class=sizeButton onclick=scoreButton('L-00'); prodID="#5e9ca2eb6aa8b2"> L </div>
              <div id=XL-00 class=sizeButton onclick=scoreButton('XL-00'); prodID="#5e9ca2eb6aa939">XL </div>
              <div id=2XL-00 class=sizeButton onclick=scoreButton('2XL-00'); prodID="#5e9ca2eb6aa9c1">2XL</div>
            -->
            </div>
          </div>

         <div class="large-8 medium-8 cell">
           <div id=colorBar-00>
             <!--
             <div class=sideBy></div>
               <div id=Color01-00 class=colorButton onclick=colorButton('Color01-00'); prodID="#5e9ca2eb6aa6f5">Co</div>
               <div id=Color02-00 class=colorButton onclick=colorButton('Color02-00'); prodID="#5e9ca2eb6aa796">Co</div>
               <div id=Color03-00 class=colorButton onclick=colorButton('Color03-00'); prodID="#5e9ca2eb6aa826">Co</div>
               <div id=Color04-00 class=colorButton onclick=colorButton('Color04-00'); prodID="#5e9ca2eb6aa8b2">Co</div>
               <div id=Color05-00 class=colorButton onclick=colorButton('Color05-00'); prodID="#5e9ca2eb6aa939">Co</div>
               <div id=Color06-00 class=colorButton onclick=colorButton('Color06-00'); prodID="#5e9ca2eb6aa9c1">Co</div>
             -->
             </div>
          </div>
       </div>

       <div class="grid-x grid-padding-x">
         <div class="large-8 medium-8 cell">
         </div>
       </div>
       <div class="grid-x grid-padding-x">

           <div class="large-4 medium-4 small-4 cell">
             <div id=showBar-00>
               <div class=sideBy>
                 <div class=sideBy onclick="showBack(1, '-00')" onmouseover="showBack(0, '-00')" onmouseout="hideBack('-00')">
                   <img id=frontImg-00 src="images/shirt_imageF000.jpg"/>
                 </div>
                 <div id=back-00 class="sideBy noshow">
                     <img id=backImg-00 class=back src="images/shirt_imageB000.jpg"/>
                 </div>
               </div>
              </div>
            </div>

            <div class="large-4 medium-4 small-4 cell">
              <div><div><div>
                    <img id=frontImg-00 src="images/mockups/lunarlogocombo.jpg"/>
              </div></div></div>
            </div>


        </div>

<!--
      <div class="grid-x grid-padding-x">
          <div class="large-4 medium-4 small-4 cell">
          </div>
          <div class="large-4 medium-4 small-4 cell">
          </div>
        </div>
        <div class="grid-x grid-padding-x">
          <div class="large-4 medium-4 small-4 cell">
          </div>
        </div>
       <div class="grid-x grid-padding-x">
           <div class="large-4 medium-4 small-4 cell">
             <div id=sButton-00 class=submitButton onclick="submitForm('-00');">Add to Cart</div>
           </div>
        </div>
-->
      </div>
      <!-- end skel -->
   </div>
<!-- ----------------------------------------------- -->
<div id="product-00"></div>
<!-- ----------------------------------------------- -->
<div id="product-01"></div>
<!-- ----------------------------------------------- -->
<div id="product-02"></div>
<!-- ----------------------------------------------- -->
<div id="product-03"></div>
<!-- ----------------------------------------------- -->
<div id="product-04"></div>
<!-- ----------------------------------------------- -->
<div id="product-05"></div>
<!-- ----------------------------------------------- -->
<div id="product-06"></div>
<!-- ----------------------------------------------- -->
<div id="product-07"></div>
<!-- ----------------------------------------------- -->
<div id="product-08"></div>
<!-- ----------------------------------------------- -->
<div id="product-09"></div>
<!-- ----------------------------------------------- -->
<div id="product-10"></div>
<!-- ----------------------------------------------- -->
<div id="product-11"></div>
<!-- ----------------------------------------------- -->
</div>

<!-- shopping cart html -->
<div id=shoppingCart>
  <table id=shoppingTable>
    <tr><td>Type</td><td>Count</td><td>Size</td><td>Cost</td><td>Price</td><td><span id=total> </span></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td><span class=submitButton id=payButton onclick="getPayPalInfo();"> Pay Now </span></td></tr>
  </table>
</div>

<div id=dataGather>
<div class=dataGather>Please give us some information...</div>
<table>
  <tr><td>Name: </td><td><input type=text id=dGName></td></tr>
  <tr><td>Email: </td><td><input type=text id=dGEMail></td></tr>
  <tr><td>Verify Email: </td><td><input type=text id=dGVerEMail></td></tr>

  <tr><td></td><td>Mailing Address</td></tr>
  <tr><td>Name: </td><td><input type=text id=dGMName></td></tr>
  <tr><td>Street Address: </td><td><input type=text id=dGAddress4></td></tr>
  <tr><td>City: </td><td><input type=text id=dGAddress5></td></tr>
  <tr><td>State: </td><td><input type=text id=dGAddress6></td></tr>
  <tr><td>Zip Code: </td><td><input type=text id=dGAddress7></td></tr>
  <tr><td>Country: </td><td><input type=text id=dGAddress8></td></tr>
  <tr><td></td><td><br><span class=submitButton onclick="getReadyForPayPal(1);">Pay Now</span><br><br><span class=cancelButton onclick="getReadyForPayPal(0);">Go Back</span></td></tr>
</table>
</div>

<!-- end shopping cart -->
</body>
<script src="js/SBdataBase.js"></script>
<script src="js/SBpayPal.js"></script>
<script src="js/oldJS.js"></script>
<script src="js/oldJS2.js"></script>
<script src="js/productSkel.js"></script>
<script src="js/colorCodes.js"></script>

<script>
// function submitForm(sfx){
//   alert(sfx);
// }

///////////////////////////////////////////////
//changeImages
//@param sfx product suffix e.g. "-02"
//@param front - file name for front image
//@param back - file name for back image
//
function changeImages(sfx,front, back, pSKEL){
  pSKEL = pSKEL.replace(/~front~/, front).replace(/~back~/, back);
  return pSKEL;
  // frontImg = document.getElementById("frontImg" + sfx);
  // frontImg.src = "images/shirt_imageF001.jpg";
  // frontImg.src = front;
  //
  // backImg = document.getElementById("backImg" + sfx);
  // backImg.src = back;
  // "images/shirt_imageB001.jpg";
}


/////////////////////////////////////////////////////////
//extractData
//@param list: {array_1,array-2...}
//       each array: [key,data]
//@param key: string equal to first element (key)
//
function extractData(key, apiSource){
  if(key in apiSource) return apiSource[key];
  // for(i in apiSource){
  //   if(key == apiSource[i][0]) return apiSource[i][1];
  // }
  return "";
}

///////////////////////////////////////////////
//extractColorSizePrice
//@param CSPColl - object to fill...
//@param apiSource - product data from api
//
function extractColorSizePrice(CSPColl, apiSource){
  // CSPArr = [];
  // var keys = Object.keys(apiSource);
  // console.log(keys);
  // console.log(apiSource);
  for(variant in apiSource["other_info"]){
      CSPArr = [];
      CSPArr.push(apiSource["other_info"][variant]["color"]);
      CSPArr.push(apiSource["other_info"][variant]["size"]);
      CSPArr.push(apiSource["other_info"][variant]["retail_price"]);
      CSPColl[apiSource["other_info"][variant]["variant_id"]] = CSPArr;
  }
  return CSPColl;
}

///////////////////////////////////////////////
//extractVariantData
//@param key to the variant object
//@param apiSource - product data from api
//
function extractVariantData(key, apiSource){
  if(apiSource["other_info"])
    return apiSource["other_info"][0][key];
  return "";
}

function extractVariantPrice(size, apiSource){
  if(apiSource["other_info"]){
    for(i in apiSource["other_info"]){
        if(apiSource["other_info"][i]["size"].trim() == size.trim()){
          return apiSource["other_info"][i]["retail_price"].trim()
        }
      }
    }
  return "";
}

function extractVariantFile(color, apiSource){
  var backup = "";
  if(apiSource["other_info"]){
    for(i in apiSource["other_info"]){
        if(apiSource["other_info"][i]["color"].trim() == color.trim()){
          for(var j=0; j<3; j++){
            if(apiSource["other_info"][i]["files"][j]["type"] == "default"){
              return apiSource["other_info"][i]["files"][j]["url"];
            }
            if(apiSource["other_info"][i]["files"][j]["type"] == "preview"){
              backup = apiSource["other_info"][i]["files"][j]["url"];
            }
          }
        }
      }
      return backup;
    }
  return "";
}


///////////////////////////////////////////////
//addSizes
//@param sfx product suffix e.g. "-02"
//@param front - file name for front image
//@param back - file name for back image
//
function addSizes(sizes, sfx, pSKEL){
  // var size = "<div id=XS-01 class=sizeButton onclick=scoreButton('XS-01'); prodID='#5e9ca2eb6aa6f5'>XS </div>";
  var sizeTemplate = "<div id=~size~~sfx~ class=sizeButton onclick=scoreButton('~size~~sfx~'); prodID='#5e9ca2eb6aa6f5'>~size~ </div>";
  sizeButtons = "";
  for (s in sizes){
    sizeButtons += sizeTemplate.replace(/~size~/g, sizes[s]).replace(/~sfx~/g, sfx);
  }
  pSKEL = pSKEL.replace("~size~array~",sizeButtons);
  return pSKEL;
  // titleBar = document.getElementById("titleBar" + sfx);
  // newHTML = "<div class=sideBy></div>"
  // titleBar.innerHTML = newHTML + sizeButton;
}


function colorButton(id,color){
  colorButton = document.getElementById(id);

  alert(arg,arg2);
}

function addColors(colors, sfx, pSKEL){
  // var colorArray = [];
  // var arr = [];
  // var newHTML = "<div class=sideBy></div>";
  var newHTML = "";
  var colCount = 0;
  var colorTemplete = "<div id=Color~col~~sfx~ class=colorButton onclick=scoreColorButton('Color~col~~sfx~','~color~'); hexVAL=\"~hex~\" prodID=\"#5e9ca2eb6aa6f5\" style=\"background-color:#~hex~;color:#~hex~;border:2px solid black;padding:3px;\">Co</div>";

  // colorBar = document.getElementById("colorBar" + sfx);
  // CBar = document.getElementById("colorBar-00");

  for(c in colors){
    co = colors[c].replace(/\s/g,'*');
    newHTML += colorTemplete.replace(/~sfx~/g, sfx).replace(/~color~/, co).replace(/~hex~/g,getHex(colors[c])).replace(/~col~/g,getSuffix(colCount));
    colCount++;
    // colorArray.push([colors[c],getHex(colors[c])]);
  }
  // colorBar.innerHTML = newHTML;
  pSKEL = pSKEL.replace(/~color~array~/, newHTML);
  return pSKEL;
  // return colorArray;
}

function addTitle(sfx, newName, pSKEL){
  pSKEL = pSKEL.replace(/~name~/,newName);
  return pSKEL;
}

function addPrice(sfx, newPrice){
  // priceTag = document.getElementById("priceTag" + sfx);
  // priceTag.innerHTML = newPrice;
}


function notInArray(key, array){
    for(e in array){
      if(key == array[e]) return false;
    }
    return true;
}

function getProductDetails(data){
  var color_array = [];
  var size_array = [];

  for(entry in data["other_info"]){
      c = data["other_info"][entry]["color"].trim();
      s = data["other_info"][entry]["size"].trim();
      if (notInArray(c, color_array)) color_array.push(c);
      if (notInArray(s, size_array)) size_array.push(s);
  }
  return {"colors": color_array, "sizes": size_array};
}

///////////////////////////////////////////////////////////
//touchUp - now it is proper HTML we can fix it up...
//@param sfx: 3-digit suffix e.g. -01
//
function touchUp(sfx){
  colorAllButtons(sfx);
}

function keepProdID(sfx, prodID, pSKEL){
  pSKEL = pSKEL.replace(/~prodNum~/g, prodID);
  return pSKEL;
}

function createNewProduct(sfx, side, data, prodID){
  //var productSkel = document.getElementById("product-00");
  // var productXX = document.getElementById("product" + sfx);
  // var hd = happyDoc;
  var pSKEL = productSkel.replace(/~sfx~/g, sfx);
  var product = document.getElementById("product" + sfx);
  if(side){
    product.classList.remove('product');
    product.classList.add('product2');
  } else {
    product.classList.remove('product2');
    product.classList.add('product');
  }

  // CSPColl = extractColorSizePrice(CSPColl, data);
  // console.log(CSPColl);
  backImageData = extractVariantData("files", data);
  var frontImage = "";
  var backImage = frontImage = extractData("thumbnail_url", data);
  for(var i=0; i < backImageData.length; i++){
    if(backImageData[i]["type"] == "back") backImage = backImageData[i]["url"];
    if(backImageData[i]["type"] == "preview") frontImage = backImageData[i]["url"];
    // if(backImageData[i]["type"] == "default") backImage = backImageData[i]["url"];
  }
  pSKEL = changeImages(sfx, frontImage, backImage, pSKEL);
  // changeImages(sfx, extractData("thumbnail_url", data),"images/shirt_imageB001.jpg");
  var productDetails = getProductDetails(data);
  pSKEL = addSizes(productDetails["sizes"],sfx, pSKEL);
  pSKEL = addColors(productDetails["colors"],sfx, pSKEL);
  // console.log(colorArray);
  // addColors(colorArray,sfx);
  pSKEL = addTitle(sfx, extractData("name", data), pSKEL);
  pSKEL = keepProdID(sfx, prodID, pSKEL);
  // addPrice(sfx, extractVariantData("retail_price", data));
  // addPrice("-01", data["other_info"][0]["retail_price"]);
  // console.log(data);
  product.innerHTML = pSKEL;
  touchUp(sfx);
}
</script>
<!-- api work -->
<script src="js/PrintFulAPI.js"></script>
<script src="js/getPFAPIData.js"></script>
<!-- area for API work -->
<style>
#outDiv1, #outDiv2 {
  visibility: hidden;
}
</style>
<div id=outDiv1></div>
<div id=outDiv2></div>
<!-- end area for API work -->
<div id=outdiv></div>
<!-- end area for database return -->
<script>
///////////////////////////////////////////////////////////////////
//building the page...
//
function getSuffix(i){
  if(i < 10) return "-0" + i;
  if(i < 100) return "-" + i;
}

function flipSide(side){
  return !side;
}

var PAGE_MAX = 8;
function buildPage(){
  // alert("build page");
  count = 0;
  leftSide = false;
  // var CSPColl = {};

  for (post in PRINTFUL_DATA){
    sfx = getSuffix(count);
    count++;
    // console.log("extacting: " + post);
    // CSPColl = extractColorSizePrice(CSPColl, PRINTFUL_DATA[post]);
    // console.log(sfx);
    createNewProduct(sfx, leftSide, PRINTFUL_DATA[post], post);
    // console.log(CSPColl);
    leftSide = flipSide(leftSide);
    if(count > PAGE_MAX) break;
  }
  // console.log(PRINTFUL_DATA);
  // console.log(CSPColl);
  pTemp = document.getElementById("product-XX");
  pTemp.parentNode.removeChild(pTemp);
  //pTemp.style.visibility = "hidden";
}


///////////////////////////////////////////////////////////////////
//testing...
//dataObj can not be passed back directly because
// this is all asyncronous... remember.
//
// var GOT_DATA = false;
function finalFunction(){
  buildPage();
  // if(GOT_DATA) return;
  // GOT_DATA = true;
}

function fillUp(){
  buildPage();
}

var outDiv = document.getElementById("outDiv1");
var outDiv2 = document.getElementById("outDiv2");
getPrintFulAPIData(outDiv, outDiv2, finalFunction);
</script>
</html>
