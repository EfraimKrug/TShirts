<!doctype html>
<html class="no-js" lang="en" dir="ltr">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Bonding</title>
  <link rel="stylesheet" type="text/css" href="css/foundation.css">
  <link rel="stylesheet" type="text/css" href="css/app.css">
  <link rel="stylesheet" type="text/css" href="css/SBTShirts.css" />
  <!-- google beginning -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
  <!-- google finished -->
  <!-- paypal beginning -->
  <script src="https://www.paypal.com/sdk/js?client-id=AfcRF9xThrarQuF4-C34Jpk9dR3d8F71Lqlpjo-SeTW3c9BI12fF7Byz5Pp3fAkIhmxaMiqpnmVJ8KI5&currency=USD" data-sdk-integration-source="button-factory"></script>
  <!-- paypal finished -->
</head>
<body>
  <div class="grid-container">
    <div class="grid-x grid-padding-x">
      <div class="large-12 cell">
        <div class=pageTitle>
          Physical Distancing, and Social BONDING!
          <br>Buy a shirt! Spread the word!
          <!-- <div type=button onclick=fillUp();>Fill the page</div> -->
        </div>
      </div>
    </div>

    <div class="grid-x grid-padding-x">
      <div  id="product-list-hold" class="large-8 medium-8 cell">

          <div  id="product-list" class="large-8 medium-8 cell">
          <div class="grid-x grid-padding-x">
            <div class="large-5 medium-5 cell">
              <div id="product-list-XX-hold" class="primary callout">
                <!-- this is where the product goes -->
<!-- starting -->
<!-- ----------------------------------------------- -->
<div id="product-00" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-01" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-02" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-03" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-04" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-05" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-06" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-07" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-08" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-09" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-10" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->
<div id="product-11" class="large-12 medium-12 cell"></div>
<!-- ----------------------------------------------- -->

</div>


<!-- end of the try -->
    </div><!-- end product-list -->
<!-- beginning right side... -->
      <div class="large-4 medium-4 cell">
        <div class="large-4 medium-4 small-4 cell">
          <div class="primary callout">
            <!-- shopping cart html -->
            <div id=shoppingCart>
              <table id=shoppingTable>
                <tr><td>Type</td><td>Count</td><td>Size</td><td>Cost</td><td>Price</td><td><span id=total> </span></td></tr>
                <tr><td></td><td></td><td></td><td></td><td></td><td><span class=submitButton id=payButton onclick="getPayPalInfo();"> Pay Now </span></td></tr>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<!-- begin dev form -->
<div id=dataGather>
<h5>Please give us some information...</h5>
<form>
  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
      <label>Name (Billing)</label>
      <input id=dGName type="text" placeholder="Who's paying?" />
    </div>
  </div>
  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
      <label>Email</label>
      <input id=dGEMail type="text" placeholder="We really do need your email address!" />
    </div>
  </div>
  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
      <label>Verify Email</label>
      <input id=dGVerEMail type="text" placeholder="If it is not correct - we can't find you!" />
    </div>
  </div>

  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
      <label>Name (recepient)</label>
      <input id=dGMName type="text" placeholder="Who gets it?" />
    </div>
  </div>
  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
      <label>Street Address</label>
      <input id=dGAddress4 type="text" placeholder="Where do we send it?" />
    </div>
  </div>

  <div class="grid-x grid-padding-x">
    <div class="large-3 medium-3 cell">
      <label>City</label>
      <input id=dGAddress5 type="text" placeholder="City?" />
    </div>
    <div class="large-3 medium-3 cell">
      <label>State</label>
      <input id=dGAddress6 type="text" placeholder="State?" />
    </div>
    <div class="large-3 medium-3 cell">
      <label>Zip Code</label>
      <input id=dGAddress7 type="text" placeholder="Zip?" />
    </div>
    <div class="large-3 medium-3 cell">
      <label>Country</label>
      <input id=dGAddress8 type="text" placeholder="USA" />
    </div>
  </div>
    <div class="grid-x grid-padding-x">
      <div class="large-12 cell">
        <span id=dGSubmit class=submitButton onclick="getReadyForPayPal(1);">Pay Now</span><span class=cancelButton id=dGCancel onclick="getReadyForPayPal(0);">Go Back</span>
      </div>
    </div>
</form>
</div>

<!-- end dev form -->

<!-- beginning paypal form -->
<div id=paypalElt>
<div class="grid-container">

  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
      <h1>Payments</h1>
    </div>
  </div>

  <div class="grid-x grid-padding-x">
    <div class="large-8 medium-8 cell">
          <div class="grid-x grid-padding-x">
            <div class="large-8 medium-8 small-8 cell">
              <span class=proceeds>Percentage of all proceeds go to COVID 19 victims.</span>
            </div>
            <div class="large-8 medium-8 small-8 cell">
              <div id=PPprice class=ppal> </div>
              <div id=PPnumber class=ppal> </div>
              <div id=PPsubTotal class=ppal> </div>
              <div id=PPshipping class=ppal> </div>
              <div id=PPtax class=ppal> </div>
            </div>
            <div class="large-8 medium-8 small-8 cell">
              <div class=RequestList>
                <div id="paypal-button-container"></div>
              </div>
            </div>
          </div>
       </div>
  </div>
</div>
</div>

<!-- end of paypal form -->
<!-- end shopping cart -->
</body>
<!-- area for API work -->
<div id=outDiv1></div>
<div id=outDiv2></div>
<!-- end area for API work -->
<!-- area for database return -->
<div id=outdiv></div>
<!-- end area for database return -->
<script src="js/SBdataBase.js"></script>
<script src="js/SBpayPal.js"></script>
<script src="js/oldJS.js"></script>
<script src="js/oldJS2.js"></script>
<script src="js/productSkel.js"></script>
<script src="js/colorCodes.js"></script>

<script src="js/dummyShipping.js"></script>

<script>
PAYMENT_BEING_PROCESSED = false;
// function submitForm(sfx){
//   alert(sfx);
// }

///////////////////////////////////////////////
//changeImages
//@param sfx product suffix e.g. "-02"
//@param front - file name for front image
//@param back - file name for back image
//
function changeImages(sfx,front, back, pSKEL){
  pSKEL = pSKEL.replace(/~front~/, front).replace(/~back~/, back);
  return pSKEL;
  // frontImg = document.getElementById("frontImg" + sfx);
  // frontImg.src = "images/shirt_imageF001.jpg";
  // frontImg.src = front;
  //
  // backImg = document.getElementById("backImg" + sfx);
  // backImg.src = back;
  // "images/shirt_imageB001.jpg";
}


/////////////////////////////////////////////////////////
//extractData
//@param list: {array_1,array-2...}
//       each array: [key,data]
//@param key: string equal to first element (key)
//
function extractData(key, apiSource){
  if(key in apiSource) return apiSource[key];
  // for(i in apiSource){
  //   if(key == apiSource[i][0]) return apiSource[i][1];
  // }
  return "";
}

///////////////////////////////////////////////
//extractColorSizePrice
//@param CSPColl - object to fill...
//@param apiSource - product data from api
//
function extractColorSizePrice(CSPColl, apiSource){
  // CSPArr = [];
  // var keys = Object.keys(apiSource);
  // console.log(keys);
  // console.log(apiSource);
  for(variant in apiSource["other_info"]){
      CSPArr = [];
      CSPArr.push(apiSource["other_info"][variant]["color"]);
      CSPArr.push(apiSource["other_info"][variant]["size"]);
      CSPArr.push(apiSource["other_info"][variant]["retail_price"]);
      CSPColl[apiSource["other_info"][variant]["variant_id"]] = CSPArr;
  }
  return CSPColl;
}

///////////////////////////////////////////////
//extractVariantData
//@param key to the variant object
//@param apiSource - product data from api
//
function extractVariantData(key, apiSource){
  if(apiSource["other_info"])
    return apiSource["other_info"][0][key];
  return "";
}

function extractVariantPrice(size, apiSource){
  if(apiSource["other_info"]){
    for(i in apiSource["other_info"]){
        if(apiSource["other_info"][i]["size"].trim() == size.trim()){
          return apiSource["other_info"][i]["retail_price"].trim()
        }
      }
    }
  return "";
}

function extractVariantFile(color, apiSource){
  var backup = "";
  if(apiSource["other_info"]){
    for(i in apiSource["other_info"]){
        if(apiSource["other_info"][i]["color"].trim() == color.trim()){
          for(var j=0; j<3; j++){
            if(apiSource["other_info"][i]["files"][j]["type"] == "default"){
              return apiSource["other_info"][i]["files"][j]["url"];
            }
            if(apiSource["other_info"][i]["files"][j]["type"] == "preview"){
              backup = apiSource["other_info"][i]["files"][j]["url"];
            }
          }
        }
      }
      return backup;
    }
  return "";
}


///////////////////////////////////////////////
//addSizes
//@param sfx product suffix e.g. "-02"
//@param front - file name for front image
//@param back - file name for back image
//
function addSizes(sizes, sfx, pSKEL){
  // var size = "<div id=XS-01 class=sizeButton onclick=scoreButton('XS-01'); prodID='#5e9ca2eb6aa6f5'>XS </div>";
  var sizeTemplate = "<div id=~size~~sfx~ class=sizeButton onclick=scoreButton('~size~~sfx~'); prodID='#5e9ca2eb6aa6f5'>~size~ </div>";
  sizeButtons = "";
  for (s in sizes){
    sizeButtons += sizeTemplate.replace(/~size~/g, sizes[s]).replace(/~sfx~/g, sfx);
  }
  pSKEL = pSKEL.replace("~size~array~",sizeButtons);
  return pSKEL;
  // titleBar = document.getElementById("titleBar" + sfx);
  // newHTML = "<div class=sideBy></div>"
  // titleBar.innerHTML = newHTML + sizeButton;
}


function colorButton(id,color){
  colorButton = document.getElementById(id);

  alert(id,color);
}

function addColors(colors, sfx, pSKEL){
  // var colorArray = [];
  // var arr = [];
  // var newHTML = "<div class=sideBy></div>";
  var newHTML = "";
  var colCount = 0;
  var colorTemplete = "<div id=Color~col~~sfx~ class=colorButton onclick=scoreColorButton('Color~col~~sfx~','~color~'); hexVAL=\"~hex~\" prodID=\"#5e9ca2eb6aa6f5\" style=\"background-color:#~hex~;color:#~hex~;border:2px solid black;padding:3px;\">Co</div>";

  // colorBar = document.getElementById("colorBar" + sfx);
  // CBar = document.getElementById("colorBar-00");

  for(c in colors){
    co = colors[c].replace(/\s/g,'*');
    newHTML += colorTemplete.replace(/~sfx~/g, sfx).replace(/~color~/, co).replace(/~hex~/g,getHex(colors[c])).replace(/~col~/g,getSuffix(colCount));
    colCount++;
    // colorArray.push([colors[c],getHex(colors[c])]);
  }
  // colorBar.innerHTML = newHTML;
  pSKEL = pSKEL.replace(/~color~array~/, newHTML);
  return pSKEL;
  // return colorArray;
}

function addTitle(sfx, newName, pSKEL){
  pSKEL = pSKEL.replace(/~name~/,newName);
  return pSKEL;
}

function addPrice(sfx, newPrice){
  // priceTag = document.getElementById("priceTag" + sfx);
  // priceTag.innerHTML = newPrice;
}


function notInArray(key, array){
    for(e in array){
      if(key == array[e]) return false;
    }
    return true;
}

/////////////////////////////////////////////////////
//sortSizes - some sizes come back out of order!
//@param size_array - an array of sizes...
//@return sorted_array - same sizes - sorted
//
function sortSizes(size_array){
  sorted_array = [];
  for(sz in size_array) {if(size_array[sz] == "XS") sorted_array.push("XS");}
  for(sz in size_array) {if(size_array[sz] == "S")  sorted_array.push("S");}
  for(sz in size_array) {if(size_array[sz] == "M")  sorted_array.push("M");}
  for(sz in size_array) {if(size_array[sz] == "L")  sorted_array.push("L");}
  for(sz in size_array) {if(size_array[sz] == "XL") sorted_array.push("XL");}
  for(sz in size_array) {if(size_array[sz] == "2XL")sorted_array.push("2XL");}
  for(sz in size_array) {if(size_array[sz] == "3XL")sorted_array.push("3XL");}
  for(sz in size_array) {if(size_array[sz] == "4XL")sorted_array.push("4XL");}
  for(sz in size_array) {if(size_array[sz] == "5XL")sorted_array.push("5XL") ;}

  return sorted_array;
}

function getProductDetails(data){
  var color_array = [];
  var size_array = [];

  for(entry in data["other_info"]){
      c = data["other_info"][entry]["color"].trim();
      s = data["other_info"][entry]["size"].trim();
      if (notInArray(c, color_array)) color_array.push(c);
      if (notInArray(s, size_array)) size_array.push(s);
  }
  return {"colors": color_array, "sizes": sortSizes(size_array)};
}

///////////////////////////////////////////////////////////
//touchUp - now it is proper HTML we can fix it up...
//@param sfx: 3-digit suffix e.g. -01
//
function touchUp(sfx){
  colorAllButtons(sfx);
}

function keepProdID(sfx, prodID, pSKEL){
  pSKEL = pSKEL.replace(/~prodNum~/g, prodID);
  return pSKEL;
}

function addExternalID(externalID,pSKEL){
    pSKEL = pSKEL.replace("~externalID~", externalID);
    return pSKEL;
}

function createNewProduct(sfx, side, data, prodID){
  //var productSkel = document.getElementById("product-00");
  // var productXX = document.getElementById("product" + sfx);
  // var hd = happyDoc;
  var pSKEL = productSkel.replace(/~sfx~/g, sfx);
  var product = document.getElementById("product" + sfx);
  if(side){
    product.classList.remove('product');
    product.classList.add('product2');
  } else {
    product.classList.remove('product2');
    product.classList.add('product');
  }

  var externalID = extractVariantData("external_id", data);
  pSKEL = addExternalID(externalID,pSKEL);
  // CSPColl = extractColorSizePrice(CSPColl, data);
  // console.log(CSPColl);
  backImageData = extractVariantData("files", data);
  var frontImage = "";
  var backImage = frontImage = extractData("thumbnail_url", data);
  for(var i=0; i < backImageData.length; i++){
    if(backImageData[i]["type"] == "back") backImage = backImageData[i]["url"];
    if(backImageData[i]["type"] == "preview") frontImage = backImageData[i]["url"];
    // if(backImageData[i]["type"] == "default") backImage = backImageData[i]["url"];
  }

  pSKEL = changeImages(sfx, frontImage, backImage, pSKEL);
  // changeImages(sfx, extractData("thumbnail_url", data),"images/shirt_imageB001.jpg");
  var productDetails = getProductDetails(data);
  pSKEL = addSizes(productDetails["sizes"],sfx, pSKEL);
  pSKEL = addColors(productDetails["colors"],sfx, pSKEL);
  // console.log(colorArray);
  // addColors(colorArray,sfx);
  pSKEL = addTitle(sfx, extractData("name", data), pSKEL);
  pSKEL = keepProdID(sfx, prodID, pSKEL);
  // addPrice(sfx, extractVariantData("retail_price", data));
  // addPrice("-01", data["other_info"][0]["retail_price"]);
  // console.log(data);
  product.innerHTML = pSKEL;
  touchUp(sfx);
  work = document.getElementById("product-list");
  // console.log(work.innerHTML);
  work.appendChild(product);
  // console.log(pSKEL);
}
</script>
<!-- api work -->
<script src="js/PrintFulAPI.js"></script>
<script src="js/getPFAPIData.js"></script>
<!-- area for API work -->
<script>
///////////////////////////////////////////////////////////////////
//building the page...
//
function getSuffix(i){
  if(i < 10) return "-0" + i;
  if(i < 100) return "-" + i;
}

function flipSide(side){
  return !side;
}

var PAGE_MAX = 8;
function buildPage(){
  // alert("build page");
  count = 0;
  leftSide = false;
  // var CSPColl = {};

  for (post in PRINTFUL_DATA){
    sfx = getSuffix(count);
    count++;
    // console.log("extacting: " + post);
    // CSPColl = extractColorSizePrice(CSPColl, PRINTFUL_DATA[post]);
    // console.log(sfx);
    createNewProduct(sfx, leftSide, PRINTFUL_DATA[post], post);
    // console.log(CSPColl);
    leftSide = flipSide(leftSide);
    if(count > PAGE_MAX) break;
  }
  // console.log(PRINTFUL_DATA);
  // console.log(CSPColl);
  // pTemp = document.getElementById("product-XX");
  // pTemp.parentNode.removeChild(pTemp);
  //pTemp.style.visibility = "hidden";
}


///////////////////////////////////////////////////////////////////
//testing...
//dataObj can not be passed back directly because
// this is all asyncronous... remember.
//
// var GOT_DATA = false;
function finalFunction(){
  buildPage();
  // if(GOT_DATA) return;
  // GOT_DATA = true;
}

function fillUp(){
  buildPage();
}

var outDiv = document.getElementById("outDiv1");
var outDiv2 = document.getElementById("outDiv2");
getPrintFulAPIData(outDiv, outDiv2, finalFunction);
</script>
</html>
